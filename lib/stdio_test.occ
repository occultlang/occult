// stdio.occ - Standard I/O library for Occult
// Provides print_string, print_integer, print_newline functions using Linux syscalls

// syscall_write: Direct Linux sys_write syscall (sys_write = 1)
// Parameters: fd, buf, count
// Returns: number of bytes written
fn syscall_write(i64 fd, i64 buf, i64 count) shellcode i64 {
    0x55
    0x48 0x89 0xE5
    0xB8 0x01 0x00 0x00 0x00
    0x0F 0x05
    0x48 0x89 0xEC
    0x5D
    0xC3
}

// print_string: Outputs a null-terminated string to stdout
// Parameters: str - pointer to null-terminated string
// Returns: 0
fn print_string(i64 str) i64 {
    // Calculate string length
    i64 len = 0;
    i64 p = str;
    
    loop {
        i64 char_val = $p;
        if char_val == 0 {
            break;
        }
        len = len + 1;
        p = p + 1;
    }
    
    // Call sys_write(stdout=1, buffer=str, count=len)
    syscall_write(1, str, len);
    
    return 0;
}

fn main() i64 {
    print_string("Test\n");
    return 0;
}
